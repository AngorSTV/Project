# Методики измерений (Metrics Methodology)

Этот документ — единый источник правды по метрикам PcBench: что измеряем, как измеряем, как интерпретируем и как превращаем измерения в рекомендации и «светофор» (зелёный/жёлтый/красный).

## Зачем нужен этот документ

1) Чтобы Agent, Backend/ML и Frontend использовали одинаковые определения метрик.
2) Чтобы рекомендации были воспроизводимыми и объяснимыми («почему так»).
3) Чтобы в 2026 без переписывания логики добавить: PDF-отчёты, B2B-SLA, расширенную телеметрию и ML-мониторинг.

## Принципы измерений

- **Воспроизводимость**: метрика имеет определение, единицы, окно агрегации и правила “качества данных”.
- **Explainability-first**: для каждой метрики должен существовать понятный пользователю вывод.
- **Quality flags**: если данные сомнительные/неполные, система обязана явно это показывать (а не “делать вид, что всё нормально”).
- **Separation of concerns**:
    - Agent отвечает за корректный сбор и маркировку качества.
    - Backend — за консистентное хранение/агрегацию.
    - ML — за производные прогнозы и вероятностные рекомендации (с признаками доверия).
    - Frontend — за объяснение, визуализацию и действие (next best action).

## Методики измерений

| Метрика | Что измеряем | Как измеряем | Интерпретация | Рекомендации |
|---|---|---|---|---|
| FPS / frametime | Производительность игр | Среднее FPS (P50), P1, 0.1% low, jitter, stutter count | Низкое FPS / нестабильный frametime → узкое место в GPU/CPU | Настройка графики, апгрейд GPU/CPU |
| CPU load | Загруженность процессора | % загрузки, температура, thermal throttling | Пиковые нагрузки → CPU-bound задачи | Апгрейд CPU, улучшение охлаждения |
| GPU load | Загруженность видеокарты | % загрузки, температура, VRAM usage | GPU перегружен → узкое место в графике | Апгрейд GPU, оптимизация настроек графики |
| RAM usage | Память | % использования, Page Faults | Недостаток памяти → замедление игр/программ | Увеличение RAM, оптимизация приложений |
| Disk I/O | Диск | Скорость чтения/записи, время отклика | Низкая скорость → долгие загрузки, лаги | SSD апгрейд, дефрагментация (для HDD) |
| Thermal throttling | Троттлинг CPU/GPU | Частота и температура в стресс-тестах | Частота падает при нагреве → троттлинг | Улучшение охлаждения, смена термопасты |
| Stability / Errors | Стабильность системы | Логи, падения тестов, sandbox integrity | Ошибки → нестабильная система | Исправление драйверов, обновление ПО |
| Predicted FPS gain (Pro) | Потенциальный прирост | ML-модель (XGBoost/PyTorch) | Прогноз прироста FPS после апгрейда | Персональная рекомендация апгрейда |

Дополнительно: контроль целостности, live-графики, отчёты с оценкой «зелёный/жёлтый/красный».

## Единый «светофор» (green / yellow / red)

Цель: один и тот же принцип окраски в UI, отчётах и B2B-обсуждениях.

- **Green**: метрика в норме, узкое место не проявляется, качество данных OK.
- **Yellow**: есть риски/пограничные значения или качество данных неидеально (например, неполные сенсоры).
- **Red**: явная деградация/троттлинг/ошибки или данные настолько плохие, что выводы ненадёжны.

Важно: конкретные пороги фиксируются отдельно (ADR или конфиг-таблица порогов), чтобы можно было менять без переписывания кода и проводить A/B.

## Quality flags (качество данных)

Каждый тест и каждая группа метрик должны иметь набор флагов качества:

- `sensor_missing`: часть датчиков не доступна (например, VRAM usage).
- `sampling_gaps`: пропуски данных (например, паузы/обрывы).
- `driver_anomaly`: подозрительные значения (скачки, нули, NaN).
- `throttling_detected`: подтверждён троттлинг.
- `crash_detected`: падение теста/приложения.
- `sandbox_integrity_failed`: нарушены условия корректного измерения (по правилам агента/песочницы).

Эти флаги — первичный вход для:
- UI (плашки “данные неполные”),
- Risk/SLA (incomplete tests),
- ML (понижать доверие к предсказаниям).

## Использование в продукте (2026+)

- **PDF-отчёты**: раздел “Метрики → Интерпретация → Рекомендации → Confidence”.
- **B2B**: превращение quality flags и incomplete tests в SLI/SLO.
- **ML**: мониторинг дрейфа и метрик качества прогнозов на эталонных наборах.
