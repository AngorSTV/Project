# ADR 0003: Trust & Ranking Policy (рекомендации и партнёрские ссылки)

- **Статус:** Proposed
- **Дата:** 2025-12-12
- **Автор:** @AngorSTV

## Контекст
PcBench формирует рекомендации (апгрейд/подбор/анализ сборки) и потенциально монетизируется через подписку и партнёрские редиректы. В этой связке есть системный риск: пользователь может воспринимать рекомендации как «продажные», если ранжирование хоть как‑то смещается в пользу партнёрских выплат.

Чтобы масштабировать продукт и монетизацию в 2026+ без потери доверия, нужна формальная политика, описывающая:
- как считается полезность рекомендаций (utility);
- где проходит граница между «рекомендовать что купить» и «куда перейти купить»;
- какие данные запрещены/разрешены в ранжировании;
- как это проверяется (аудит, метрики, регрессионные тесты).

## Цель
- Зафиксировать проверяемые правила, гарантирующие, что рекомендации оптимизируются под пользу пользователя, а не под доходность.
- Сохранить возможность монетизировать «покупательский» поток (выбор магазина/ссылки) без влияния на выбор компонентов/советов.
- Подготовить основу для будущей эволюции ранжирования (больше компонентов, прайс‑агрегация, ML‑ранжирование), не ломая доверие.

## Варианты
### Option A — Жёсткий запрет партнёрских сигналов на любом этапе
**Плюсы:** максимальная прозрачность и простота объяснения.
**Минусы:** теряется возможность оптимизации выбора магазина (напр. когда есть 10 идентичных вариантов товара и нужно выбрать «куда вести»).

### Option B — Полное смешивание: партнёрские ставки участвуют в ранжировании компонентов
**Плюсы:** потенциально выше выручка.
**Минусы:** разрушает доверие, создаёт конфликт интересов, повышает юридические и репутационные риски.

### Option C — Двухконтурная модель: отдельный utility‑скоринг рекомендаций и отдельный merchant/link‑скоринг
**Плюсы:** сохраняет доверие и монетизацию, архитектурно масштабируется.
**Минусы:** требует дисциплины в данных и аналитике, нужна прозрачная маркировка партнёрских ссылок.

## Решение
Выбираем **Option C (двухконтурная модель)**.

### 1) Что ранжируем
Разделяем две задачи:
1) **Recommendation Ranking** — «что рекомендовать» (компоненты/апгрейды/советы).
2) **Link/Merchant Ranking** — «куда вести покупать» для уже выбранного товара/варианта.

### 2) Политика данных (что запрещено/разрешено)
**Запрещено в Recommendation Ranking:**
- affiliate payout / комиссионные / ставка партнёра;
- наличие/отсутствие партнёрства как фича;
- любые proxy‑сигналы, явно коррелирующие с выплатой (например, merchantId, если он используется как канал монетизации).

**Разрешено в Recommendation Ranking:**
- совместимость (socket, chipset, PCIe, RAM type, TDP и т.д.);
- прогноз прироста (performance delta по сценариям: обучение/игры/программирование/офис);
- стоимость апгрейда (price), если доступна;
- метрики стабильности (frametime/температуры) и риски узких мест;
- пользовательские предпочтения (бюджет, шум, энергопотребление), если заданы.

**Разрешено в Link/Merchant Ranking:**
- цена, наличие, сроки доставки, условия возврата, рейтинг/репутация магазина;
- региональная доступность;
- тип ссылки (партнёрская/непартнёрская) — только для disclosure и аналитики;
- партнёрская ставка допускается **только как последний tie‑breaker**, если:
  - речь идёт об *одном и том же товаре* (один SKU/модель);
  - разница по цене/условиям находится в пределах заранее заданного порога (например, ≤ 1–2%);
  - это не меняет выбор товара/рекомендации, а только порядок одинаковых ссылок.

### 3) Формальный принцип “No Paid Placement”
- PcBench **не** выбирает «хуже по полезности» ради доходности.
- Если партнёрская ссылка показывает более слабые условия (хуже цена/наличие/доставка) — она не должна попадать выше в выдаче для того же товара.

### 4) Прозрачность (disclosure)
- Все партнёрские ссылки помечаются в UI.
- В документации/оферте объясняется, что партнёрские выплаты **не влияют** на выбор рекомендаций.

## Последствия
### Положительные
- Повышается доверие: правила просты и проверяемы.
- Можно масштабировать аффилиат‑часть без «токсичности» для рекомендаций.
- Готовность к ML‑эволюции: запретные/разрешённые признаки уже определены.

### Негативные / риски
- Потребуются аудит и тесты: иначе правило будет «на словах».
- Больше инженерных затрат на аналитическую модель событий (клики, показы, выбор).

## План внедрения
### Phase 1 — Техническое разделение контуров
- Ввести две функции/модуля: `RecommendationScoreEngine` и `MerchantScoreEngine` (или аналогичные интерфейсы).
- В данных события выбора фиксировать отдельно:
  - `recommendation_id`, `scenario`, `candidate_set_hash`, `utility_score`;
  - `outbound_link_id`, `merchant_score`, `is_affiliate` (для disclosure/аналитики).

### Phase 2 — Аудит и тесты доверия
- Регрессионные тесты: при изменении partner payout результат Recommendation Ranking **не меняется**.
- Логи/трассировка: возможность объяснить топ‑N рекомендаций (feature attribution на уровне правил/весов).
- Дашборды: доля партнёрских ссылок в показах/кликах, жалобы, отклонения от правила tie‑breaker.

### Phase 3 — Управление изменениями (governance)
- Любое изменение правил ранжирования проходит через ADR и код‑ревью.
- Для изменений, влияющих на ранжирование, проводить A/B с метриками доверия (NPS/жалобы/retention), а не только с revenue.

## Метрики успеха
- **Trust:** жалобы на «рекламу», NPS/оценка полезности рекомендаций, доля отключений disclosure (если появится).
- **Quality:** CTR по рекомендациям без роста негативных сигналов, повторные сессии (D7/D30).
- **Compliance:** 0 инцидентов «paid placement», подтверждённых аудитом/тестами.

## Открытые вопросы
- Источник цен/наличия (агрегация vs ручные источники) и частота обновления.
- Порог tie‑breaker по цене/условиям (1–2% или абсолютный лимит).
- Нужен ли режим «без партнёрских ссылок» для Pro/Creator как усиление доверия.

## Ссылки
- docs/adr/0002-monetization-v1.md
- docs/context.md
- docs/roadmap.md
